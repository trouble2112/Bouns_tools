# 待业务确认问题清单

本文档列出了奖金计算规则中存在歧义或需要业务方确认的问题。
在正式使用计算工具前，请逐项确认并调整相应参数。

---

## 📋 确认清单概览

| 序号 | 问题类别 | 问题描述 | 当前默认处理 | 优先级 |
|------|---------|---------|-------------|--------|
| 1 | 完成奖叠加 | 90%与100%是否叠加发放 | DM=exclusive, 其他=stack | ⚠️ 高 |
| 2 | 回款门槛 | 90%/100%奖的回款率阈值 | 85%/90% | ⚠️ 高 |
| 3 | 发放节奏 | 50%即时/50%回款后是否影响计算 | 只算总额 | 中 |
| 4 | 二次分配 | 个人分配比例的输入来源 | 手工输入 | 中 |
| 5 | DM完成奖 | 分公司完成奖的cap是否适用于叠加后 | 单档cap 40000 | ⚠️ 高 |
| 6 | 区域完成定义 | "区域完成"的判定标准 | 外部输入是/否 | 中 |
| 7 | 产值口径 | 个人产值vs团队产值vs分公司产值 | 按输入区分 | 中 |

---

## 1️⃣ 90%与100%完成奖叠加模式

### 问题描述
当完成率同时达到90%和100%时，完成奖如何计算？

### 两种处理方式

| 模式 | 说明 | 举例（假设单档奖金1万） |
|------|------|----------------------|
| **exclusive** | 仅发放最高档，不叠加 | 达到100%时只发1万 |
| **stack** | 两档叠加发放 | 达到100%时发2万（90%档1万+100%档1万）|

### 当前默认设置

| 岗位 | 默认模式 | 配置参数 |
|------|---------|---------|
| 总经理DM | exclusive | `dm_completion_bonus_mode` |
| 副总经理/部门经理/销售 | stack | `other_completion_bonus_mode` |

### 对计算结果的影响
- **exclusive模式**：达到100%的人只拿100%档奖金
- **stack模式**：达到100%的人拿90%档+100%档，金额翻倍

### 需要确认的问题
1. DM岗位是否确定使用exclusive模式？
2. 其他岗位是否确定使用stack模式？
3. 是否所有岗位应统一使用同一模式？

### 修改方法

**Excel模板**：在「全局参数」表修改：
- `DM_STACK_MODE` 单元格
- `OTHER_STACK_MODE` 单元格

**Python引擎**：
```python
from config import GlobalConfig, CompletionBonusMode

config = GlobalConfig(
    dm_completion_bonus_mode=CompletionBonusMode.STACK,  # 改为叠加
    other_completion_bonus_mode=CompletionBonusMode.EXCLUSIVE  # 改为不叠加
)
```

---

## 2️⃣ 回款率门槛

### 问题描述
发放完成奖需要满足的最低回款率是多少？

### 当前默认设置

| 奖项 | 回款率门槛 | 配置参数 |
|------|-----------|---------|
| 90%完成奖 | ≥ 85% | `threshold_90` |
| 100%完成奖 | ≥ 90% | `threshold_100` |

### 需要确认的问题
1. 85%和90%的门槛是否正确？
2. 不同岗位的门槛是否相同？
3. 门槛是"大于等于"还是"大于"？（当前实现为"大于等于"）

### 对计算结果的影响
- 回款率刚好处于门槛边界的人，门槛设定直接影响是否能拿到奖金
- 门槛越高，能拿到奖金的人越少

### 修改方法

**Excel模板**：在「全局参数」表修改：
- `THRESHOLD_90` 单元格
- `THRESHOLD_100` 单元格

**Python引擎**：
```python
config = GlobalConfig(
    threshold_90=0.80,   # 降低到80%
    threshold_100=0.85   # 降低到85%
)
```

---

## 3️⃣ 50/50发放节奏

### 问题描述
规则提到部分奖项"50%即时发放，50%回款后发放"，这是否影响计算口径？

### 两种处理方式

| 模式 | 说明 |
|------|------|
| 只算总额 | 计算时不区分发放时间，只输出应得总额 |
| 拆分显示 | 输出时拆分为"即时发放"和"回款后发放"两部分 |

### 当前默认设置
- `include_payout_timing = false`（只算总额）

### 需要确认的问题
1. 是否需要在报表中显示拆分后的金额？
2. "50%回款后发放"是否有额外的回款条件？
3. 哪些岗位的哪些奖项需要拆分？

### 适用岗位（根据规则推断）
- 部门经理：过程激励可选拆分
- 销售-用户部：过程激励可选拆分
- 销售-新购：过程激励可选拆分
- 销售-高校：过程激励可选拆分

### 修改方法

**Python引擎**：
```python
config = GlobalConfig(
    include_payout_timing=True  # 开启拆分显示
)
```

---

## 4️⃣ 个人分配比例来源

### 问题描述
完成奖按"个人分配比例"分配到个人，这个比例从哪里来？

### 可能的来源

| 来源 | 说明 | 当前实现 |
|------|------|---------|
| 手工输入 | HR或管理者在系统中手填 | ✓ 当前方式 |
| 按产值占比 | 个人产值/团队产值自动计算 | 可扩展 |
| 固定比例 | 按职级设定固定比例 | 可扩展 |

### 当前默认设置
- 通过 `personal_allocation_ratio` 字段手工输入
- 若未填写，显示完成奖总额（不分配到个人）

### 需要确认的问题
1. 分配比例是否需要自动计算？
2. 同一组织单元内的分配比例合计应该等于多少？（当前校验为≤1，但可以<1）
3. 若比例合计<1，剩余部分如何处理？

### 校验规则
- 单人分配比例：0 ≤ 值 ≤ 1
- 同组织单元合计：≤ 1（若超过会警告）

---

## 5️⃣ DM完成奖上限适用范围

### 问题描述
DM完成奖有40000的上限（cap），在叠加模式下如何适用？

### 两种理解

| 理解 | 计算方式 | 举例（产值1亿） |
|------|---------|----------------|
| 单档cap | 每档分别计算后cap | 90%档=min(1亿×0.4%,4万)=4万, 100%档=min(1亿×0.4%,4万)=4万 |
| 合计cap | 两档合计后cap | 合计=min(90%档+100%档, 4万)=4万 |

### 当前默认设置
- **单档cap**：90%档和100%档分别计算，各自不超过40000
- 若使用stack模式，叠加后最高可达80000

### 需要确认的问题
1. 40000是单档上限还是合计上限？
2. 若是合计上限，exclusive模式和stack模式下是否一致？

### 对计算结果的影响
假设分公司产值2000万，DM完成100%：
- 单档cap+stack模式：80000（40000+40000）
- 合计cap：40000

### 修改方法
如需改为合计cap，需修改 `bonus_engine.py` 中 `_calculate_dm` 方法。

---

## 6️⃣ 区域/全国完成的判定标准

### 问题描述
"大区完成90%"、"全国完成100%"的判定依据是什么？

### 当前处理方式
- 作为输入参数，由用户直接填写"是/否"
- 不在计算引擎内部判定

### 需要确认的问题
1. 判定标准是什么？（完成率？回款率？综合指标？）
2. 判定数据从哪里来？（需要对接其他系统？）
3. 是否需要在工具内自动计算？

### 建议
如需自动判定，需要：
1. 定义区域/全国层面的产值汇总
2. 定义区域/全国层面的目标
3. 添加相应的计算逻辑

---

## 7️⃣ 产值口径说明

### 问题描述
不同计算场景使用的产值口径不同。

### 当前设计

| 字段 | 用途 | 说明 |
|------|------|------|
| `month_revenue` | 过程激励计算 | 个人（或负责的）月度产值 |
| `company_total_revenue` | 完成奖计算 | 分公司整体产值 |
| `annual_target` | 完成率计算 | 全年目标 |

### 需要确认的问题
1. "过程激励"使用的是个人产值还是团队产值？
2. "分公司完成奖"的产值基数是否正确？
3. 不同岗位的产值口径是否相同？

### 特殊情况处理
- 若未填写 `company_total_revenue`，默认使用个人产值合计

---

## 📝 确认记录表

请业务方在下表中记录确认结果：

| 序号 | 问题 | 确认结果 | 确认人 | 确认日期 |
|------|------|---------|--------|---------|
| 1 | 90%/100%叠加模式 | | | |
| 2 | 回款率门槛 | | | |
| 3 | 50/50发放显示 | | | |
| 4 | 分配比例来源 | | | |
| 5 | DM完成奖cap范围 | | | |
| 6 | 区域完成判定标准 | | | |
| 7 | 产值口径 | | | |

---

## 🔧 配置修改指南

确认后，按以下步骤修改配置：

### Excel模板
1. 打开「全局参数」工作表
2. 在「当前值」列修改相应参数
3. 黄色标记的单元格为待确认项

### Python引擎
```python
from config import GlobalConfig, CompletionBonusMode

# 根据确认结果创建配置
confirmed_config = GlobalConfig(
    # 叠加模式
    dm_completion_bonus_mode=CompletionBonusMode.EXCLUSIVE,  # 或 STACK
    other_completion_bonus_mode=CompletionBonusMode.STACK,   # 或 EXCLUSIVE
    
    # 回款门槛
    threshold_90=0.85,
    threshold_100=0.90,
    
    # 发放拆分
    include_payout_timing=False,
)

# 使用确认后的配置
from bonus_engine import BonusCalculator
calculator = BonusCalculator(global_config=confirmed_config)
```

---

## 📌 版本记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| 1.0 | 2026-01-28 | 初始版本，列出所有待确认问题 |

---

*本文档由奖金计算工具自动生成，请与业务方确认后更新配置。*
