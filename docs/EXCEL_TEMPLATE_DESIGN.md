# Excel模板设计说明

## 工作表清单

| 序号 | 工作表名称 | 用途 | 保护状态 |
|------|-----------|------|----------|
| 1 | 首页 | 使用说明、版本信息 | 全锁定 |
| 2 | 全局参数 | 系统参数配置 | 部分可编辑 |
| 3 | 人员数据 | 人员信息与产值录入 | 输入区可编辑 |
| 4 | 常委CP | 常委奖金计算 | 公式锁定 |
| 5 | 总经理DM | 总经理奖金计算 | 公式锁定 |
| 6 | 管理层 | 副总/部门经理奖金计算 | 公式锁定 |
| 7 | 销售团队 | 销售人员奖金计算 | 公式锁定 |
| 8 | 汇总报表 | 分类汇总与总计 | 全锁定 |
| 9 | 数据校验 | 异常检测与提示 | 全锁定 |
| 10 | 字典表 | 下拉选项、岗位映射 | 全锁定 |

---

## 1. 首页工作表

### 布局设计
```
┌────────────────────────────────────────────────────────┐
│           2026上半年奖金计算工具 V1.0                    │
├────────────────────────────────────────────────────────┤
│  版本：1.0                                              │
│  更新日期：2026-01-28                                    │
│  适用范围：2026年1-6月奖金计算                            │
├────────────────────────────────────────────────────────┤
│  使用步骤：                                             │
│  1. 确认「全局参数」表中的参数设置                        │
│  2. 在「人员数据」表录入人员信息和产值                    │
│  3. 查看各岗位工作表的计算结果                           │
│  4. 检查「数据校验」表确认无异常                         │
│  5. 在「汇总报表」表查看最终结果                         │
├────────────────────────────────────────────────────────┤
│  ⚠️ 待业务确认项目（见「全局参数」表黄色标记）            │
│  - 90%与100%完成奖叠加模式                              │
│  - 回款率阈值确认                                       │
│  - 50/50发放节奏是否需要拆分显示                        │
└────────────────────────────────────────────────────────┘
```

---

## 2. 全局参数工作表

### 字段定义

| 行号 | 参数名称 | 参数代码 | 默认值 | 可选值 | 说明 | 待确认 |
|------|---------|---------|--------|--------|------|--------|
| 3 | 1月时间系数 | TIME_COEFF_01 | 1.15 | 0-2 | 1月产值激励系数 | |
| 4 | 2月时间系数 | TIME_COEFF_02 | 1.15 | 0-2 | 2月产值激励系数 | |
| 5 | 3月时间系数 | TIME_COEFF_03 | 1.10 | 0-2 | 3月产值激励系数 | |
| 6 | 4月时间系数 | TIME_COEFF_04 | 1.00 | 0-2 | 4月产值激励系数 | |
| 7 | 5月时间系数 | TIME_COEFF_05 | 0.90 | 0-2 | 5月产值激励系数 | |
| 8 | 6月时间系数 | TIME_COEFF_06 | 0.85 | 0-2 | 6月产值激励系数 | |
| 10 | 90%奖回款门槛 | THRESHOLD_90 | 0.85 | 0-1 | 发放90%完成奖的最低回款率 | ✓ |
| 11 | 100%奖回款门槛 | THRESHOLD_100 | 0.90 | 0-1 | 发放100%完成奖的最低回款率 | ✓ |
| 13 | DM叠加模式 | DM_STACK_MODE | exclusive | exclusive/stack | exclusive=仅发最高档; stack=累计发放 | ✓ |
| 14 | 其他岗位叠加模式 | OTHER_STACK_MODE | stack | exclusive/stack | 副总/部门经理/销售的叠加模式 | ✓ |
| 16 | 完成率计算模式 | COMPLETION_MODE | from_target | from_target/manual | 自动计算或手工填写 | |
| 17 | 是否拆分发放 | SHOW_PAYOUT_SPLIT | FALSE | TRUE/FALSE | 是否显示50%即时/50%回款后拆分 | ✓ |
| 19 | 常委固定补贴(半年) | CP_SUBSIDY | 60000 | >=0 | 常委固定补贴总额 | |
| 20 | 销售月补贴 | SALES_MONTHLY_SUB | 800 | >=0 | 新购/高校销售月度补贴 | |

### 单元格布局（建议）

```
    A                B              C          D           E            F
1   参数设置表        
2   参数名称         参数代码        默认值      当前值       说明         待确认
3   1月时间系数      TIME_COEFF_01   1.15       1.15        ...          
4   2月时间系数      TIME_COEFF_02   1.15       1.15        ...
...
```

### 命名范围定义

| 名称 | 引用 | 说明 |
|------|------|------|
| TIME_COEFF | =$D$3:$D$8 | 时间系数数组 |
| THRESHOLD_90 | =$D$10 | 90%门槛 |
| THRESHOLD_100 | =$D$11 | 100%门槛 |
| DM_STACK_MODE | =$D$13 | DM叠加模式 |
| OTHER_STACK_MODE | =$D$14 | 其他岗位叠加模式 |
| COMPLETION_MODE | =$D$16 | 完成率模式 |
| SHOW_PAYOUT_SPLIT | =$D$17 | 是否拆分显示 |

### 数据验证规则

| 参数 | 验证类型 | 验证条件 | 错误提示 |
|------|---------|---------|---------|
| 时间系数 | 小数 | 0 <= 值 <= 2 | 时间系数应在0-2之间 |
| 回款门槛 | 小数 | 0 <= 值 <= 1 | 回款门槛应在0-1之间 |
| 叠加模式 | 列表 | exclusive,stack | 请选择叠加模式 |
| 完成率模式 | 列表 | from_target,manual | 请选择计算模式 |
| 是否拆分 | 列表 | TRUE,FALSE | 请选择是/否 |

---

## 3. 人员数据工作表

### 输入区字段定义

| 列 | 字段名 | 代码 | 类型 | 必填 | 验证规则 | 说明 |
|----|--------|------|------|------|---------|------|
| A | 序号 | ID | 数字 | 是 | 自动 | 自动编号 |
| B | 姓名 | NAME | 文本 | 是 | 非空 | 员工姓名 |
| C | 岗位 | ROLE | 文本 | 是 | 下拉 | CP/DM/VP/MGR/SALES_USER/SALES_NEW/SALES_EDU |
| D | 区域 | REGION | 文本 | 是 | 下拉 | 华北/华东/华南/西南/西北/东北 |
| E | 组织单元 | ORG_UNIT | 文本 | 是 | 非空 | 分公司/部门名称 |
| F | 1月产值 | REV_01 | 数字 | 是 | >=0 | 个人/团队1月产值 |
| G | 2月产值 | REV_02 | 数字 | 是 | >=0 | 个人/团队2月产值 |
| H | 3月产值 | REV_03 | 数字 | 是 | >=0 | 个人/团队3月产值 |
| I | 4月产值 | REV_04 | 数字 | 是 | >=0 | 个人/团队4月产值 |
| J | 5月产值 | REV_05 | 数字 | 是 | >=0 | 个人/团队5月产值 |
| K | 6月产值 | REV_06 | 数字 | 是 | >=0 | 个人/团队6月产值 |
| L | 分公司总产值 | COMPANY_REV | 数字 | 条件 | >=0 | 分公司汇总产值（非CP必填）|
| M | 年度目标 | ANNUAL_TARGET | 数字 | 条件 | >0 | 全年目标（from_target模式必填）|
| N | 完成率(手填) | COMPLETION_MANUAL | 百分比 | 条件 | 0-2 | manual模式必填 |
| O | 回款率 | COLLECTION_RATE | 百分比 | 是 | 0-1 | 当前回款率 |
| P | 区域完成90% | REGION_90 | 布尔 | 是 | 下拉 | 是/否 |
| Q | 区域完成100% | REGION_100 | 布尔 | 是 | 下拉 | 是/否 |
| R | 全国完成90% | NATIONAL_90 | 布尔 | 是 | 下拉 | 是/否 |
| S | 全国完成100% | NATIONAL_100 | 布尔 | 是 | 下拉 | 是/否 |
| T | 个人分配比例 | ALLOC_RATIO | 百分比 | 否 | 0-1 | 完成奖个人分配比例 |
| U | CEO奖金 | CEO_BONUS | 数字 | 否 | >=0 | CEO手动填写奖金 |

### 计算区字段（自动计算，锁定）

| 列 | 字段名 | 公式 | 说明 |
|----|--------|------|------|
| V | 产值合计 | =SUM(F:K) | 个人产值汇总 |
| W | 完成率(计算) | =IF(COMPLETION_MODE="from_target",V/M,N) | 根据模式选择 |
| X | 过程激励比例 | =VLOOKUP(C,字典表!比例映射,2,0) | 查表获取比例 |
| Y | 数据状态 | =校验公式 | 正常/异常 |

### 关键公式

**产值合计 (V列)**
```excel
=SUM(F2:K2)
```

**完成率计算 (W列)**
```excel
=IF(COMPLETION_MODE="from_target",
    IF(M2>0, V2/M2, 0),
    N2)
```

**过程激励比例查询 (X列)**
```excel
=VLOOKUP(C2, 字典表!$A$2:$B$10, 2, FALSE)
```

**数据状态校验 (Y列)**
```excel
=IF(OR(
    O2<0, O2>1,                           -- 回款率范围
    AND(T2<>"", OR(T2<0, T2>1)),          -- 分配比例范围
    MIN(F2:K2)<0,                          -- 产值为负
    AND(C2<>"CP", L2=""),                  -- 非CP缺分公司产值
    AND(COMPLETION_MODE="from_target", M2<=0)  -- 缺年度目标
), "异常", "正常")
```

---

## 4. 常委CP工作表

### 字段布局

| 列 | 字段名 | 类型 | 公式/来源 |
|----|--------|------|----------|
| A | 序号 | 引用 | =人员数据!A |
| B | 姓名 | 引用 | =人员数据!B |
| C | 固定补贴 | 计算 | =CP_SUBSIDY |
| D | 大区90%奖 | 计算 | 条件公式 |
| E | 大区100%奖 | 计算 | 条件公式 |
| F | 全国90%奖 | 计算 | 条件公式 |
| G | 全国100%奖 | 计算 | 条件公式 |
| H | CEO奖金 | 引用 | =人员数据!U |
| I | 奖金合计 | 计算 | =SUM(C:H) |

### 关键公式

**筛选常委数据（假设数据从第2行开始）**
```excel
-- 判断是否为常委岗位
=IF(人员数据!C2="CP", 计算公式, "")
```

**固定补贴 (C列)**
```excel
=IF(人员数据!$C2="CP", CP_SUBSIDY, "")
```

**大区90%奖 (D列)**
```excel
=IF(AND(人员数据!$C2="CP", 人员数据!$P2="是"), 30000, 0)
```

**大区100%奖 (E列)**
```excel
=IF(AND(人员数据!$C2="CP", 人员数据!$Q2="是"), 30000, 0)
```

**全国90%奖 (F列)**
```excel
=IF(AND(人员数据!$C2="CP", 人员数据!$R2="是"), 40000, 0)
```

**全国100%奖 (G列)**
```excel
=IF(AND(人员数据!$C2="CP", 人员数据!$S2="是"), 40000, 0)
```

**奖金合计 (I列)**
```excel
=IF(人员数据!$C2="CP", SUM(C2:H2), "")
```

---

## 5. 总经理DM工作表

### 字段布局

| 列 | 字段名 | 类型 | 说明 |
|----|--------|------|------|
| A | 序号 | 引用 | |
| B | 姓名 | 引用 | |
| C | 1月过程激励 | 计算 | 产值×0.4%×时间系数 |
| D | 2月过程激励 | 计算 | |
| E | 3月过程激励 | 计算 | |
| F | 4月过程激励 | 计算 | |
| G | 5月过程激励 | 计算 | |
| H | 6月过程激励 | 计算 | |
| I | 过程激励小计 | 计算 | =SUM(C:H) |
| J | 分公司90%奖 | 计算 | 条件公式 |
| K | 分公司100%奖 | 计算 | 条件公式 |
| L | 完成奖小计 | 计算 | 根据叠加模式 |
| M | 大区完成奖 | 计算 | 条件公式 |
| N | CEO奖金 | 引用 | |
| O | 奖金合计 | 计算 | |
| P | 叠加模式标记 | 显示 | 显示当前使用的模式 |

### 关键公式

**月度过程激励 (C列示例 - 1月)**
```excel
=IF(人员数据!$C2="DM",
    人员数据!$F2 * 0.004 * INDEX(TIME_COEFF,1),
    "")
```

**过程激励小计 (I列)**
```excel
=IF(人员数据!$C2="DM", SUM(C2:H2), "")
```

**分公司90%完成奖 (J列)**
```excel
=IF(AND(
    人员数据!$C2="DM",
    人员数据!$W2>=0.9,
    人员数据!$O2>=THRESHOLD_90
), MIN(人员数据!$L2*0.004, 40000), 0)
```

**分公司100%完成奖 (K列)**
```excel
=IF(AND(
    人员数据!$C2="DM",
    人员数据!$W2>=1.0,
    人员数据!$O2>=THRESHOLD_100
), MIN(人员数据!$L2*0.004, 40000), 0)
```

**完成奖小计 - 根据叠加模式 (L列)** ⚠️待确认
```excel
=IF(人员数据!$C2="DM",
    IF(DM_STACK_MODE="exclusive",
        MAX(J2, K2),           -- exclusive: 只取最高档
        J2 + K2                -- stack: 叠加
    ),
    "")
```

**大区完成奖 (M列)**
```excel
=IF(AND(人员数据!$C2="DM", 人员数据!$P2="是"), 40000, 0)
```

**叠加模式标记 (P列)**
```excel
=IF(人员数据!$C2="DM",
    "当前模式: "&DM_STACK_MODE&" [待业务确认]",
    "")
```

---

## 6. 管理层工作表（副总经理/部门经理）

### 字段布局

| 列 | 字段名 | 说明 |
|----|--------|------|
| A | 序号 | |
| B | 姓名 | |
| C | 岗位 | VP/MGR |
| D | 过程激励比例 | 查表: VP=0.4%, MGR=1.0% |
| E-J | 1-6月过程激励 | 分月计算 |
| K | 过程激励小计 | |
| L | 即时发放(50%) | 可选显示 |
| M | 回款后发放(50%) | 可选显示 |
| N | 分公司完成奖总额 | 分公司产值×1.5% |
| O | 90%档完成奖 | 条件判断 |
| P | 100%档完成奖 | 条件判断 |
| Q | 完成奖小计 | 根据叠加模式 |
| R | 个人分配比例 | |
| S | 个人完成奖 | Q×R |
| T | CEO奖金 | |
| U | 奖金合计 | |

### 关键公式

**过程激励比例 (D列)**
```excel
=IF(OR(C2="VP",C2="MGR"),
    VLOOKUP(C2, 字典表!$A$2:$B$10, 2, FALSE),
    "")
```

**月度过程激励 (E列示例)**
```excel
=IF(OR($C2="VP",$C2="MGR"),
    人员数据!F2 * $D2 * INDEX(TIME_COEFF,1),
    "")
```

**即时发放50% (L列)** - 仅当SHOW_PAYOUT_SPLIT=TRUE时显示
```excel
=IF(AND(OR($C2="VP",$C2="MGR"), SHOW_PAYOUT_SPLIT=TRUE),
    K2 * 0.5,
    "")
```

**分公司完成奖总额 (N列)**
```excel
=IF(OR($C2="VP",$C2="MGR"),
    人员数据!$L2 * 0.015,
    "")
```

**90%档完成奖 (O列)**
```excel
=IF(AND(
    OR($C2="VP",$C2="MGR"),
    人员数据!$W2>=0.9,
    人员数据!$O2>=THRESHOLD_90
), N2, 0)
```

**100%档完成奖 (P列)**
```excel
=IF(AND(
    OR($C2="VP",$C2="MGR"),
    人员数据!$W2>=1.0,
    人员数据!$O2>=THRESHOLD_100
), N2, 0)
```

**完成奖小计 - 根据叠加模式 (Q列)** ⚠️待确认
```excel
=IF(OR($C2="VP",$C2="MGR"),
    IF(OTHER_STACK_MODE="exclusive",
        MAX(O2, P2),
        O2 + P2
    ),
    "")
```

**个人完成奖 (S列)**
```excel
=IF(AND(OR($C2="VP",$C2="MGR"), R2<>""),
    Q2 * R2,
    Q2)  -- 若未填分配比例，显示总额
```

---

## 7. 销售团队工作表

### 字段布局

| 列 | 字段名 | 说明 |
|----|--------|------|
| A | 序号 | |
| B | 姓名 | |
| C | 岗位 | SALES_USER/SALES_NEW/SALES_EDU |
| D | 过程激励比例 | 查表: USER=2%, NEW/EDU=3% |
| E-J | 1-6月过程激励 | |
| K | 过程激励小计 | |
| L | 即时发放(50%) | 可选 |
| M | 回款后发放(50%) | 可选 |
| N | 月补贴 | NEW/EDU: 800×6 |
| O | 分公司完成奖总额 | |
| P | 90%档完成奖 | |
| Q | 100%档完成奖 | |
| R | 完成奖小计 | |
| S | 个人分配比例 | |
| T | 个人完成奖 | |
| U | CEO奖金 | |
| V | 奖金合计 | |

### 关键公式

**过程激励比例 (D列)**
```excel
=IF(LEFT(C2,5)="SALES",
    VLOOKUP(C2, 字典表!$A$2:$B$10, 2, FALSE),
    "")
```

**月补贴 (N列)**
```excel
=IF(OR(C2="SALES_NEW", C2="SALES_EDU"),
    SALES_MONTHLY_SUB * 6,
    0)
```

**完成奖小计 (R列)** ⚠️待确认
```excel
=IF(LEFT($C2,5)="SALES",
    IF(OTHER_STACK_MODE="exclusive",
        MAX(P2, Q2),
        P2 + Q2
    ),
    "")
```

**奖金合计 (V列)**
```excel
=IF(LEFT($C2,5)="SALES",
    K2 + N2 + T2 + U2,
    "")
```

---

## 8. 汇总报表工作表

### 布局设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  2026上半年奖金汇总报表                              生成日期: =TODAY()      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【按岗位汇总】                                                              │
│  岗位       人数    过程激励    完成奖    区域奖    全国奖    补贴    CEO奖    合计  │
│  常委CP      x        -         -        xxx      xxx      xxx     xxx     xxx  │
│  总经理DM    x       xxx       xxx       xxx       -        -      xxx     xxx  │
│  ...                                                                        │
│  合计        x       xxx       xxx       xxx      xxx      xxx     xxx     xxx  │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  【按区域汇总】                                                              │
│  区域       人数    奖金合计                                                  │
│  华北        x       xxx                                                     │
│  ...                                                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  【明细清单】                                                                │
│  序号  姓名  岗位  区域  过程激励  完成奖  区域奖  全国奖  补贴  CEO奖  合计   │
│  1     xxx   xxx   xxx    xxx     xxx    xxx    xxx    xxx   xxx   xxx    │
│  ...                                                                        │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 关键汇总公式

**按岗位汇总人数**
```excel
=COUNTIF(人员数据!$C:$C, "CP")
```

**按岗位汇总奖金**
```excel
=SUMIF(人员数据!$C:$C, "CP", 常委CP!$I:$I)
```

**按区域汇总**
```excel
=SUMIF(人员数据!$D:$D, "华北", 汇总!$合计列)
```

---

## 9. 数据校验工作表

### 校验项目清单

| 校验项 | 规则 | 公式 | 严重程度 |
|--------|------|------|---------|
| 回款率范围 | 0 <= 值 <= 1 | =IF(OR(回款率<0,回款率>1),"异常","正常") | 错误 |
| 产值非负 | 所有产值 >= 0 | =IF(MIN(产值列)<0,"异常","正常") | 错误 |
| 分配比例范围 | 0 <= 值 <= 1 | =IF(OR(比例<0,比例>1),"异常","正常") | 错误 |
| 分配比例合计 | 同组织<=1 | =SUMIF公式 | 警告 |
| 完成率合理性 | 0 <= 值 <= 2 | =IF(完成率>2,"可能异常","正常") | 警告 |
| 必填字段 | 非空 | =IF(ISBLANK(字段),"缺失","正常") | 错误 |
| 岗位有效性 | 在字典表中 | =IF(ISERROR(MATCH(...)),"无效","正常") | 错误 |
| 区域有效性 | 在字典表中 | =IF(ISERROR(MATCH(...)),"无效","正常") | 错误 |

### 校验结果展示

```
┌───────────────────────────────────────────────────────────────────┐
│  数据校验结果                                                      │
├───────────────────────────────────────────────────────────────────┤
│  总记录数: =COUNTA(人员数据!A:A)-1                                  │
│  错误数量: =COUNTIF(状态列,"错误")    ⚠️ 必须为0才能继续             │
│  警告数量: =COUNTIF(状态列,"警告")    ℹ️ 建议检查                   │
├───────────────────────────────────────────────────────────────────┤
│  【异常明细】                                                      │
│  行号    姓名    字段        问题描述        当前值    严重程度     │
│  5      张三    回款率      超出有效范围     1.2       错误        │
│  12     李四    分配比例    合计超过100%    1.15      警告        │
│  ...                                                              │
└───────────────────────────────────────────────────────────────────┘
```

### 分配比例组内校验公式

```excel
-- 检查同一组织单元内分配比例合计是否超过1
=IF(SUMIF(人员数据!$E:$E, E2, 人员数据!$T:$T)>1,
    "警告: "&E2&"分配比例合计超过100%",
    "正常")
```

---

## 10. 字典表工作表

### 岗位代码与名称映射

| 岗位代码 | 岗位名称 | 过程激励比例 | 有完成奖 | 有区域奖 | 有全国奖 | 有固定补贴 |
|---------|---------|-------------|---------|---------|---------|-----------|
| CP | 常委 | 0 | 否 | 是 | 是 | 是 |
| DM | 总经理 | 0.004 | 是 | 是 | 否 | 否 |
| VP | 副总经理 | 0.004 | 是 | 否 | 否 | 否 |
| MGR | 部门经理 | 0.01 | 是 | 否 | 否 | 否 |
| SALES_USER | 销售-用户部 | 0.02 | 是 | 否 | 否 | 否 |
| SALES_NEW | 销售-新购 | 0.03 | 是 | 否 | 否 | 是 |
| SALES_EDU | 销售-高校 | 0.03 | 是 | 否 | 否 | 是 |

### 区域列表

| 区域代码 | 区域名称 |
|---------|---------|
| NORTH | 华北 |
| EAST | 华东 |
| SOUTH | 华南 |
| SOUTHWEST | 西南 |
| NORTHWEST | 西北 |
| NORTHEAST | 东北 |

### 下拉选项源

| 名称 | 值列表 |
|------|--------|
| 是否选项 | 是,否 |
| 叠加模式 | exclusive,stack |
| 完成率模式 | from_target,manual |

---

## 单元格保护策略

### 保护规则

| 区域类型 | 填充颜色 | 保护状态 | 说明 |
|---------|---------|---------|------|
| 输入单元格 | 浅黄色 #FFFDE7 | 未锁定 | 用户可编辑 |
| 计算单元格 | 浅灰色 #F5F5F5 | 锁定 | 公式保护 |
| 标题单元格 | 深蓝色 #1976D2 | 锁定 | 白色字体 |
| 待确认标记 | 橙色 #FFA726 | 锁定 | 提醒业务确认 |
| 异常提示 | 红色 #EF5350 | 锁定 | 错误高亮 |

### 工作表保护设置

```
保护密码: [建议设置]
允许操作:
  ✓ 选择未锁定的单元格
  ✓ 选择锁定的单元格
  ✗ 设置单元格格式
  ✗ 插入/删除行列
  ✗ 排序/筛选 (除汇总表)
```

---

## 条件格式规则

### 数据校验高亮

```
规则1: 回款率异常
  应用范围: 人员数据!$O:$O
  条件: =OR($O2<0, $O2>1)
  格式: 红色填充

规则2: 产值异常
  应用范围: 人员数据!$F:$K
  条件: =F2<0
  格式: 红色填充

规则3: 分配比例异常
  应用范围: 人员数据!$T:$T
  条件: =OR($T2<0, $T2>1)
  格式: 红色填充
```

### 完成率视觉指示

```
规则: 完成率颜色条
  应用范围: 人员数据!$W:$W
  条件: 数据条
  颜色: 绿色渐变 (0%=红, 90%=黄, 100%=绿)
```
